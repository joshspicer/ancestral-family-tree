<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Details</title>
  </head>
  <body>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
    <div class=container>
        <h1 id="NAME"></h1>
        
        <p>
        <span id="BIRTH"></span>
        <span id="BLOC"></span>
        </p>

        <p>
            <span id="DEATH"></span>
            <span id="DLOC"></span>
        </p>

        <p>
            <span id="NAT"></span>
            <span id="NLOC"></span>
        </p>
        
        <br>

            <span id="DOCS"></span>

        <br>

         <span id="MARRIAGE"></span>
         

    </div>


    </body>

    <script>
        var person = null;
            function parseCookie () {
                var split = document.cookie.split("=");
                person = JSON.parse(split[1]);
            }
            function buildUI () {
                document.getElementById("NAME").innerHTML =  person.name ?? "ðŸš¨ Error ðŸš¨";
                
                document.getElementById("BIRTH").innerHTML =  person.birth ? `ðŸŽ‚ ${person.birth}`: "";
                document.getElementById("BLOC").innerHTML =  person.bloc ? `${person.bloc}`: "";

                document.getElementById("DEATH").innerHTML =  person.death ? `ðŸª¦ ${person.death}`: "";
                document.getElementById("DLOC").innerHTML =  person.dloc ? `${person.dloc}`: "";


                document.getElementById("NAT").innerHTML =  person.nat ? `ðŸ‡ºðŸ‡¸ ${person.nat}`: "";
                document.getElementById("NLOC").innerHTML =  person.nloc ? `${person.nloc}`: "";

                // Render the personal PDF
                document.getElementById("DOCS").innerHTML = `    
                <h2>Personal Docs</h2>        
                <object data="./docs/${person.id}.pdf" type="application/pdf" width="1000" height="1000">
                    <embed src="./docs/${person.id}.pdf" type="application/pdf"/>
                </object>`

                try {
                    var maybeSpouse =  "";
                    var marriage = "";
                    person.parent._parents.forEach(element => {
                        if (element != null) {
                            maybeSpouse = element.id;
                        }
                    });

                    console.log(maybeSpouse)

                    if (maybeSpouse == null || maybeSpouse == "" ) {
                        throw "No Spouse";
                    }

                    if (person.gender === "male") {
                        marriage = `${maybeSpouse}${person.id}`;
                    } else {
                        marriage = `${person.id}${maybeSpouse}`;
                    }

                    console.log(marriage);

                    // Render the Marriage PDF 
                    document.getElementById("MARRIAGE").innerHTML = `       
                    <h2>Marriage Docs</h2>             
                    <object data="./docs/${marriage}.pdf" type="application/pdf" width="1000" height="1000">
                        <embed src="./docs/${marriage}.pdf" type="application/pdf"/>
                    </object>`
                    } catch(err) {
                        console.log("No spouse assigned.")
                        // do nothing. 
                    }
            }

        parseCookie ();
        console.log (person);
        buildUI ();
    </script>

</html>